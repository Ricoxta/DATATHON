---
title: "DATATHON"
author: "Ricardo Torres Arevalo, Jack Landers"
date: "2023-02-18"
output: html_document
---


## Brainstorm  

Questions we will be answering  

_What trends do we notice in the basket size (total items in one receipt)?_  

_Which items should the store stop selling? Why?_  


## How we will solve themm


## Loading data  

```{r, message=FALSE}
library(tidyverse)
library(scales)
store <- read_delim("sales_data_2017_2018_for_tableau_with_new_date_columns.csv")

store %>% 
  dim()

names(store)

```

### Basket Size Data?
```{r}
  store %>% 
  group_by(receipt_id) %>% 
  arrange(receipt_id)  
  
  
```

```{r}
store %>% 
  group_by(receipt_id) %>% 
  summarise(main_cat_count = length(main_category)) 
  
```

This shows the amount of max amount of 

```{r}

```


```{r}

store %>% 
group_by(main_category) %>% 
summarise(main_cc = length(main_category), profit = sum(total_profit)) %>% 
  arrange(desc(main_cc))

```
```{r}
store %>% 
  group_by(sub_category) %>% 
  filter(total_profit < 0, year == 2017) %>% 
  summarise(profit_2017 = sum(total_profit)) %>% 
  filter(rank(profit_2017) <= 20) %>% 
    arrange(profit_2017)
  
```

*2017 LOSSES*

```{r}
store %>% 
  group_by(sub_category) %>% 
  filter(total_profit < 0, year == 2018) %>% 
  summarise(profit_2018 = sum(total_profit)) %>% 
  filter(rank(profit_2018) <= 20) %>% 
    arrange(profit_2018)
  
```

*2018 WORSE OF YEAAR MOY LIFE*

```{r}
store %>% 
  group_by(sub_category) %>% 
  filter(year == 2017) %>% 
  summarise(amount_2017 = sum(quantity)) %>% 
  filter(rank(desc(amount_2017)) <= 15) %>% 
    arrange(desc(amount_2017))
  
```

*This shows the most bought sub categories in the store. Items that could be dropped would be Asian Veggies since they are not being sold a lot compared to its other sub categories and the store is paying money to import them which is causing loss in profit in that sub category. Something else we can get rid of are condiments since they are also not selling as much as the other categories and their loss in profit has increased more in 2018 than it has in 2017. Therefore, if the store does not get rid of it, then the loss in profit will only increase over the next couple of years. *

```{r}
store %>% 
  group_by(sub_category) %>% 
  filter(year == 2018) %>% 
  summarise(amount_2018 = sum(quantity)) %>% 
  filter(rank(desc(amount_2018)) <= 15) %>% 
    arrange(desc(amount_2018))
```


```{r}
store %>% 
  group_by(sub_category) %>% 
  filter(year == 2017) %>% 
  summarise(amt_2017 = sum(quantity)) %>% 
  filter(rank(amt_2017) <= 15) %>% 
  arrange(amt_2017)
   
```

*Shows quantity sold for each sub category in the year 2017*


```{r}
store %>% 
  group_by(sub_category) %>% 
  filter(year == 2018) %>% 
  summarise(amt_2018 = sum(quantity)) %>% 
   filter(rank(amt_2018) <= 15) %>% 
  arrange(amt_2018)
   
```

_Shows quantity sold for each sub category in the year 2018_  

```{r}
store %>% 
  group_by(sub_category) %>% 
  summarise(sub_cc = length(sub_category)) %>%
  arrange(sub_cc)
```

  
```{r}
store %>% 
  filter(total_profit < 0)%>% 
  filter(sub_category == "Cabbages") %>% 
  mutate(loss = sum(total_profit), amount = sum(quantity)) %>% 
  select(item_name, loss, amount) %>% 
  head(1)
  
  
```
  
FROM OUR ANALYSIS, we should stop selling Wombok Cabbages because they are the only item that is causing loss in profit. Meanwhile the rest of the cabbages gain profit after each purchase.



```{r}
store %>% 
  filter(total_profit < 0) %>% 
  filter(sub_category == "Avocadoes") %>% 
  mutate(loss = sum(total_profit), amount = sum(quantity)) %>% 
  select(item_name, loss, amount) %>% 
  head(1)
```
Another item that the store could get rid of would be Avocado Hass Medium since the are the item that loses the second most amount of profit and it is not sold as much as the rest of the avocadoes.



## Finding the most profitable month by sales
how to approach 

```{r}
store %>% 
  ggplot(aes(month_number, total_profit, fill = factor(month_number)))+
  geom_col()+
  geom_line()+
  scale_x_continuous(breaks = pretty_breaks())+
  labs(x = "Months (by number)",
       y = "Total Profits ($)",
       fill = "Month Number\n")
```

Australia has opposite seasons from us, therefore whenever we have our winter season, they have summer. The peak amount of sales for the store occur when Australia is in its summer season.


```{r}
store %>% 
  filter(sub_category == "Apples") %>% 
  # filter(total_profit > 0) %>%  
  arrange(total_profit)
  # summarise(apple_profit = mean(total_profit))
```

Another item that the store should get rid of is Apple Granny Smith 1kg bags because they barely make any sales and are the only apple product that is making the store lose money.

```{r}
store %>% 
  group_by(hour) %>% 
  mutate(profit = sum(total_profit)) %>% 
  ggplot(aes(hour, profit, fill = factor(year)))+
  geom_col(position = "dodge")+
  scale_x_continuous(breaks = pretty_breaks())
```

According to this thing, the total profits for the hour in 2017 match the total profits for 2018. However, since 2017 was run 24/7 they generate the greater profit then 2018 because they are not missing out on the money. 
